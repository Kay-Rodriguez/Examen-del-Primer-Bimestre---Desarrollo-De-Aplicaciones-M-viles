{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/KarlaR/Downloads/movistarexamen_project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { supabase } from 'src/app/supabase';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/forms\";\nfunction ChatsPage_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"small\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"date\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const m_r1 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(m_r1.mensaje);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 2, m_r1.created_at, \"short\"));\n  }\n}\nexport let ChatsPage = /*#__PURE__*/(() => {\n  class ChatsPage {\n    constructor(route) {\n      this.route = route;\n      this.mensajes = [];\n      this.nuevoMensaje = '';\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.contratacionId = Number(_this.route.snapshot.paramMap.get('id'));\n        _this.cargarMensajes();\n        _this.escucharMensajes();\n      })();\n    }\n    cargarMensajes() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data\n        } = yield supabase.from('mensajes_chat').select('*').eq('contratacion_id', _this2.contratacionId).order('created_at', {\n          ascending: true\n        });\n        _this2.mensajes = data || [];\n      })();\n    }\n    escucharMensajes() {\n      supabase.channel('mensajes').on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'mensajes_chat'\n      }, payload => {\n        if (payload.new.contratacion_id === this.contratacionId) {\n          this.mensajes.push(payload.new);\n        }\n      }).subscribe();\n    }\n    enviar() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const user = (yield supabase.auth.getUser()).data.user;\n        yield supabase.from('mensajes_chat').insert({\n          contratacion_id: _this3.contratacionId,\n          emisor_id: user.id,\n          mensaje: _this3.nuevoMensaje\n        });\n        _this3.nuevoMensaje = '';\n      })();\n    }\n    static {\n      this.ɵfac = function ChatsPage_Factory(t) {\n        return new (t || ChatsPage)(i0.ɵɵdirectiveInject(i1.ActivatedRoute));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ChatsPage,\n        selectors: [[\"app-chats\"]],\n        decls: 12,\n        vars: 2,\n        consts: [[\"color\", \"primary\"], [1, \"chat-container\"], [\"class\", \"msg\", 4, \"ngFor\", \"ngForOf\"], [\"placeholder\", \"Escribe...\", 3, \"ngModelChange\", \"ngModel\"], [\"color\", \"success\", 3, \"click\"], [1, \"msg\"]],\n        template: function ChatsPage_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\", 0)(2, \"ion-title\");\n            i0.ɵɵtext(3, \"Chat\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(4, \"ion-content\")(5, \"div\", 1);\n            i0.ɵɵtemplate(6, ChatsPage_div_6_Template, 6, 5, \"div\", 2);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"ion-footer\")(8, \"ion-toolbar\")(9, \"ion-input\", 3);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ChatsPage_Template_ion_input_ngModelChange_9_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.nuevoMensaje, $event) || (ctx.nuevoMensaje = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(10, \"ion-button\", 4);\n            i0.ɵɵlistener(\"click\", function ChatsPage_Template_ion_button_click_10_listener() {\n              return ctx.enviar();\n            });\n            i0.ɵɵtext(11, \"Enviar\");\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngForOf\", ctx.mensajes);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.nuevoMensaje);\n          }\n        },\n        dependencies: [i2.NgForOf, i3.IonButton, i3.IonContent, i3.IonFooter, i3.IonHeader, i3.IonInput, i3.IonTitle, i3.IonToolbar, i3.TextValueAccessor, i4.NgControlStatus, i4.NgModel, i2.DatePipe]\n      });\n    }\n  }\n  return ChatsPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}