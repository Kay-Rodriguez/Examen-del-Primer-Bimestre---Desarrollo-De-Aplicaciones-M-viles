{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/KarlaR/Downloads/movistarexamen_project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { createClient } from '@supabase/supabase-js';\nimport * as i0 from \"@angular/core\";\nexport let SupabaseService = /*#__PURE__*/(() => {\n  class SupabaseService {\n    constructor() {\n      this.supabase = createClient('TU_URL_SUPABASE', 'TU_PUBLIC_ANON_KEY');\n    }\n    // ============================================================\n    // ðŸ” AUTENTICACIÃ“N\n    // ============================================================\n    signUp(nombre, email, pass, telefono) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data,\n          error\n        } = yield _this.supabase.auth.signUp({\n          email,\n          password: pass\n        });\n        if (error) throw error;\n        // Crear perfil con rol usuario_registrado\n        yield _this.supabase.from('perfiles').insert({\n          id: data.user?.id,\n          nombre_completo: nombre,\n          telefono,\n          rol: 'usuario_registrado'\n        });\n        return data;\n      })();\n    }\n    signIn(email, pass) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data,\n          error\n        } = yield _this2.supabase.auth.signInWithPassword({\n          email,\n          password: pass\n        });\n        if (error) throw error;\n        return data;\n      })();\n    }\n    getPerfilActual() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data: {\n            user\n          }\n        } = yield _this3.supabase.auth.getUser();\n        if (!user) return null;\n        const {\n          data\n        } = yield _this3.supabase.from('perfiles').select('*').eq('id', user.id).single();\n        return data;\n      })();\n    }\n    logout() {\n      return this.supabase.auth.signOut();\n    }\n    // ============================================================\n    // ðŸ“¦ PLANES MÃ“VILES\n    // ============================================================\n    getPlanesPublicos() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data,\n          error\n        } = yield _this4.supabase.from('planes_moviles').select('*').eq('activo', true).order('id', {\n          ascending: true\n        });\n        if (error) throw error;\n        return data;\n      })();\n    }\n    // Asesor â†’ crear plan\n    crearPlan(plan) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          error\n        } = yield _this5.supabase.from('planes_moviles').insert(plan);\n        if (error) throw error;\n      })();\n    }\n    // Asesor â†’ editar plan\n    editarPlan(id, plan) {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          error\n        } = yield _this6.supabase.from('planes_moviles').update(plan).eq('id', id);\n        if (error) throw error;\n      })();\n    }\n    // ============================================================\n    // ðŸ§¾ CONTRATACIONES\n    // ============================================================\n    contratarPlan(planId) {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data: {\n            user\n          }\n        } = yield _this7.supabase.auth.getUser();\n        const {\n          error\n        } = yield _this7.supabase.from('contrataciones').insert({\n          usuario_id: user?.id,\n          plan_id: planId\n        });\n        if (error) throw error;\n      })();\n    }\n    misContratos() {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data: {\n            user\n          }\n        } = yield _this8.supabase.auth.getUser();\n        const {\n          data,\n          error\n        } = yield _this8.supabase.from('contrataciones').select('*, planes_moviles(*)').eq('usuario_id', user?.id);\n        if (error) throw error;\n        return data;\n      })();\n    }\n    // ============================================================\n    // ðŸ’¬ CHAT\n    // ============================================================\n    enviarMensaje(contratacion_id, texto) {\n      var _this9 = this;\n      return _asyncToGenerator(function* () {\n        const {\n          data: {\n            user\n          }\n        } = yield _this9.supabase.auth.getUser();\n        const {\n          error\n        } = yield _this9.supabase.from('mensajes_chat').insert({\n          contratacion_id,\n          mensaje: texto,\n          emisor_id: user?.id\n        });\n        if (error) throw error;\n      })();\n    }\n    escucharChat(contratacionId, callback) {\n      return this.supabase.channel('chat_room_' + contratacionId).on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'mensajes_chat',\n        filter: `contratacion_id=eq.${contratacionId}`\n      }, payload => callback(payload.new)).subscribe();\n    }\n    static {\n      this.Éµfac = function SupabaseService_Factory(t) {\n        return new (t || SupabaseService)();\n      };\n    }\n    static {\n      this.Éµprov = /*@__PURE__*/i0.ÉµÉµdefineInjectable({\n        token: SupabaseService,\n        factory: SupabaseService.Éµfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return SupabaseService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}