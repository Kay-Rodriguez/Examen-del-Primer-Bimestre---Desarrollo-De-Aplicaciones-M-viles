{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/KarlaR/Downloads/movistarexamen_project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { supabase } from 'src/app/supabase';\nlet ChatsPage = class ChatsPage {\n  constructor(route) {\n    this.route = route;\n    this.mensajes = [];\n    this.nuevoMensaje = '';\n  }\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.contratacionId = Number(_this.route.snapshot.paramMap.get('id'));\n      _this.cargarMensajes();\n      _this.escucharMensajes();\n    })();\n  }\n  cargarMensajes() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const {\n        data\n      } = yield supabase.from('mensajes_chat').select('*').eq('contratacion_id', _this2.contratacionId).order('created_at', {\n        ascending: true\n      });\n      _this2.mensajes = data || [];\n    })();\n  }\n  escucharMensajes() {\n    supabase.channel('mensajes').on('postgres_changes', {\n      event: 'INSERT',\n      schema: 'public',\n      table: 'mensajes_chat'\n    }, payload => {\n      if (payload.new.contratacion_id === this.contratacionId) {\n        this.mensajes.push(payload.new);\n      }\n    }).subscribe();\n  }\n  enviar() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const user = (yield supabase.auth.getUser()).data.user;\n      yield supabase.from('mensajes_chat').insert({\n        contratacion_id: _this3.contratacionId,\n        emisor_id: user.id,\n        mensaje: _this3.nuevoMensaje\n      });\n      _this3.nuevoMensaje = '';\n    })();\n  }\n};\nChatsPage = __decorate([Component({\n  selector: 'app-chats',\n  templateUrl: './chats.page.html',\n  styleUrls: ['./chats.page.scss']\n})], ChatsPage);\nexport { ChatsPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}