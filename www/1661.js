"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1661],{1661:(C,h,o)=>{o.r(h),o.d(h,{ChatsPageModule:()=>_});var c=o(177),d=o(4341),s=o(8974),m=o(70),l=o(467),n=o(4438),p=o(9593);function f(e,r){if(1&e){const t=n.RV6();n.j41(0,"ion-item",6),n.bIt("click",function(){const i=n.eBV(t).$implicit,u=n.XpG(2);return n.Njj(u.abrirChat(i))}),n.nrm(1,"ion-icon",7),n.j41(2,"ion-label")(3,"h3"),n.EFF(4),n.k0s(),n.j41(5,"p"),n.EFF(6),n.nI1(7,"uppercase"),n.nI1(8,"date"),n.k0s()()()}if(2&e){const t=r.$implicit;n.R7$(4),n.JRh(null==t.planes_moviles?null:t.planes_moviles.nombre),n.R7$(2),n.Lme("",n.bMT(7,3,t.estado)," - ",n.i5U(8,5,t.created_at,"short"),"")}}function v(e,r){if(1&e&&(n.j41(0,"div",3)(1,"h2"),n.EFF(2,"Mis Chats"),n.k0s(),n.j41(3,"p",4),n.EFF(4,"Selecciona un plan contratado para conversar con un asesor."),n.k0s(),n.j41(5,"ion-list"),n.DNE(6,f,9,8,"ion-item",5),n.k0s()()),2&e){const t=n.XpG();n.R7$(6),n.Y8G("ngForOf",t.contratos)}}function g(e,r){if(1&e&&(n.j41(0,"div",22)(1,"p"),n.EFF(2),n.k0s(),n.j41(3,"span"),n.EFF(4),n.nI1(5,"date"),n.k0s()()),2&e){const t=r.$implicit;n.R7$(2),n.JRh(t.mensaje),n.R7$(2),n.JRh(n.i5U(5,2,t.created_at,"shortTime"))}}function j(e,r){if(1&e){const t=n.RV6();n.j41(0,"div",8)(1,"ion-header",9)(2,"ion-toolbar")(3,"ion-buttons",10)(4,"ion-button",11),n.bIt("click",function(){n.eBV(t);const i=n.XpG();return n.Njj(i.seleccionado=null)}),n.nrm(5,"ion-icon",12),n.k0s()(),n.j41(6,"ion-title"),n.EFF(7),n.j41(8,"div",13),n.EFF(9,"Conversaci\xf3n con asesor"),n.k0s()()()(),n.j41(10,"ion-content",14)(11,"div",15),n.DNE(12,g,6,5,"div",16),n.k0s()(),n.j41(13,"ion-footer",17)(14,"ion-item",18)(15,"ion-input",19),n.mxI("ngModelChange",function(i){n.eBV(t);const u=n.XpG();return n.DH7(u.nuevoMensaje,i)||(u.nuevoMensaje=i),n.Njj(i)}),n.k0s(),n.j41(16,"ion-button",20),n.bIt("click",function(){n.eBV(t);const i=n.XpG();return n.Njj(i.enviar())}),n.nrm(17,"ion-icon",21),n.k0s()()()()}if(2&e){const t=n.XpG();n.R7$(7),n.SpI(" ",null==t.seleccionado.planes_moviles?null:t.seleccionado.planes_moviles.nombre," "),n.R7$(5),n.Y8G("ngForOf",t.mensajes),n.R7$(3),n.R50("ngModel",t.nuevoMensaje)}}const b=[{path:"",component:(()=>{class e{constructor(t){this.supabaseSvc=t,this.contratos=[],this.seleccionado=null,this.mensajes=[],this.nuevoMensaje="",this.canal=null}ngOnInit(){var t=this;return(0,l.A)(function*(){yield t.cargarContratos()})()}ngOnDestroy(){this.canal&&this.canal.unsubscribe()}cargarContratos(){var t=this;return(0,l.A)(function*(){t.contratos=yield t.supabaseSvc.misContratos()})()}abrirChat(t){var a=this;return(0,l.A)(function*(){a.seleccionado=t,a.mensajes=yield a.supabaseSvc.obtenerMensajes(t.id),a.canal&&a.canal.unsubscribe(),a.canal=a.supabaseSvc.escucharChat(t.id,i=>{a.mensajes=[...a.mensajes,i]})})()}enviar(){var t=this;return(0,l.A)(function*(){!t.nuevoMensaje.trim()||!t.seleccionado||(yield t.supabaseSvc.enviarMensaje(t.seleccionado.id,t.nuevoMensaje.trim()),t.nuevoMensaje="")})()}static{this.\u0275fac=function(a){return new(a||e)(n.rXU(p.w))}}static{this.\u0275cmp=n.VBU({type:e,selectors:[["app-chats-usuario"]],decls:7,vars:2,consts:[[1,"header-gradient"],["class","lista-conversaciones ion-padding",4,"ngIf"],["class","chat-wrapper",4,"ngIf"],[1,"lista-conversaciones","ion-padding"],[1,"sub"],["button","","detail","true",3,"click",4,"ngFor","ngForOf"],["button","","detail","true",3,"click"],["name","chatbubbles-outline","slot","start"],[1,"chat-wrapper"],[1,"chat-header"],["slot","start"],["fill","clear",3,"click"],["name","arrow-back-outline"],[1,"sub-titulo"],[1,"chat-content"],[1,"mensajes"],["class","burbuja",4,"ngFor","ngForOf"],[1,"chat-footer"],["lines","none"],["placeholder","Escribe un mensaje...",3,"ngModelChange","ngModel"],[3,"click"],["name","send-outline"],[1,"burbuja"]],template:function(a,i){1&a&&(n.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),n.EFF(3,"Chat con Asesor"),n.k0s()()(),n.j41(4,"ion-content"),n.DNE(5,v,7,1,"div",1)(6,j,18,3,"div",2),n.k0s()),2&a&&(n.R7$(5),n.Y8G("ngIf",!i.seleccionado),n.R7$(),n.Y8G("ngIf",i.seleccionado))},dependencies:[c.Sq,c.bT,d.BC,d.vS,s.Jm,s.QW,s.W9,s.M0,s.eU,s.iq,s.$w,s.uz,s.he,s.nf,s.BC,s.ai,s.Gw,c.Pc,c.vh],styles:[".mensajes[_ngcontent-%COMP%]{padding:15px}.burbuja[_ngcontent-%COMP%]{max-width:75%;background:#fff;padding:10px;border-radius:14px;margin-bottom:8px;box-shadow:0 2px 8px #0000001a}.burbuja.mine[_ngcontent-%COMP%]{margin-left:auto;background:#0033a0;color:#fff}ion-footer[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: #fff}"]})}}return e})()}];let _=(()=>{class e{static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275mod=n.$C({type:e})}static{this.\u0275inj=n.G2t({imports:[c.MD,d.YN,s.bv,m.iI.forChild(b)]})}}return e})()}}]);