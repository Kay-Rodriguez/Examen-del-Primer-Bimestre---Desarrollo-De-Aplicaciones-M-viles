"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[369],{369:(C,h,o)=>{o.r(h),o.d(h,{ChatsAsesorPageModule:()=>_});var l=o(177),u=o(4341),a=o(8974),p=o(70),d=o(467),n=o(4438),m=o(9593);function f(e,c){if(1&e){const t=n.RV6();n.j41(0,"ion-item",5),n.bIt("click",function(){const i=n.eBV(t).$implicit,r=n.XpG(2);return n.Njj(r.abrirChat(i))}),n.j41(1,"ion-label")(2,"h2"),n.EFF(3),n.k0s(),n.j41(4,"p"),n.EFF(5),n.k0s()()()}if(2&e){const t=c.$implicit;n.R7$(3),n.JRh(null==t.perfiles?null:t.perfiles.nombre_completo),n.R7$(2),n.JRh(null==t.planes_moviles?null:t.planes_moviles.nombre)}}function g(e,c){if(1&e&&(n.j41(0,"div",3)(1,"ion-list"),n.DNE(2,f,6,2,"ion-item",4),n.k0s()()),2&e){const t=n.XpG();n.R7$(2),n.Y8G("ngForOf",t.contratos)}}function v(e,c){if(1&e&&(n.j41(0,"div",15)(1,"p"),n.EFF(2),n.k0s(),n.j41(3,"small"),n.EFF(4),n.nI1(5,"date"),n.k0s()()),2&e){const t=c.$implicit;n.R7$(2),n.JRh(t.mensaje),n.R7$(2),n.JRh(n.i5U(5,2,t.created_at,"shortTime"))}}function j(e,c){if(1&e){const t=n.RV6();n.j41(0,"div",6)(1,"div",7)(2,"ion-button",8),n.bIt("click",function(){n.eBV(t);const i=n.XpG();return n.Njj(i.seleccionado=null)}),n.nrm(3,"ion-icon",9),n.k0s(),n.j41(4,"strong"),n.EFF(5),n.k0s()(),n.j41(6,"div",10),n.DNE(7,v,6,5,"div",11),n.k0s(),n.j41(8,"div",12)(9,"ion-input",13),n.mxI("ngModelChange",function(i){n.eBV(t);const r=n.XpG();return n.DH7(r.nuevoMensaje,i)||(r.nuevoMensaje=i),n.Njj(i)}),n.k0s(),n.j41(10,"ion-button",14),n.bIt("click",function(){n.eBV(t);const i=n.XpG();return n.Njj(i.enviar())}),n.EFF(11,"Enviar"),n.k0s()()()}if(2&e){const t=n.XpG();n.R7$(5),n.JRh(null==t.seleccionado.perfiles?null:t.seleccionado.perfiles.nombre_completo),n.R7$(2),n.Y8G("ngForOf",t.mensajes),n.R7$(2),n.R50("ngModel",t.nuevoMensaje)}}const b=[{path:"",component:(()=>{class e{constructor(t){this.supabaseSvc=t,this.contratos=[],this.seleccionado=null,this.mensajes=[],this.nuevoMensaje="",this.canal=null}ngOnInit(){this.cargarContratos()}ngOnDestroy(){this.canal&&this.canal.unsubscribe()}cargarContratos(){var t=this;return(0,d.A)(function*(){t.contratos=yield t.supabaseSvc.contratosAprobadosAsesor()})()}abrirChat(t){var s=this;return(0,d.A)(function*(){s.seleccionado=t,s.mensajes=yield s.supabaseSvc.obtenerMensajes(t.id),s.canal&&s.canal.unsubscribe(),s.canal=s.supabaseSvc.escucharChat(t.id,i=>{s.mensajes=[...s.mensajes,i]})})()}enviar(){var t=this;return(0,d.A)(function*(){!t.nuevoMensaje.trim()||!t.seleccionado||(yield t.supabaseSvc.enviarMensaje(t.seleccionado.id,t.nuevoMensaje.trim()),t.nuevoMensaje="")})()}static{this.\u0275fac=function(s){return new(s||e)(n.rXU(m.w))}}static{this.\u0275cmp=n.VBU({type:e,selectors:[["app-chats"]],decls:7,vars:2,consts:[["color","primary"],["class","lista-chat",4,"ngIf"],["class","chat-box",4,"ngIf"],[1,"lista-chat"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"chat-box"],[1,"header-chat"],["fill","clear",3,"click"],["name","arrow-back-outline"],[1,"mensajes"],["class","bubble",4,"ngFor","ngForOf"],[1,"enviar"],["placeholder","Escribe...",3,"ngModelChange","ngModel"],[3,"click"],[1,"bubble"]],template:function(s,i){1&s&&(n.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),n.EFF(3,"Chats"),n.k0s()()(),n.j41(4,"ion-content"),n.DNE(5,g,3,1,"div",1)(6,j,12,3,"div",2),n.k0s()),2&s&&(n.R7$(5),n.Y8G("ngIf",!i.seleccionado),n.R7$(),n.Y8G("ngIf",i.seleccionado))},dependencies:[l.Sq,l.bT,u.BC,u.vS,a.Jm,a.W9,a.eU,a.iq,a.$w,a.uz,a.he,a.nf,a.BC,a.ai,a.Gw,l.vh],styles:[".layout[_ngcontent-%COMP%]{display:flex;height:100%}.lista[_ngcontent-%COMP%]{width:35%;border-right:1px solid #ccc}.chat[_ngcontent-%COMP%]{width:65%;display:flex;flex-direction:column}.mensajes[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:10px}.mensaje[_ngcontent-%COMP%]{background:#e8e8ff;margin-bottom:10px;padding:10px;border-radius:8px}.input-chat[_ngcontent-%COMP%]{display:flex;padding:10px;gap:10px}"]})}}return e})()}];let _=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=n.$C({type:e})}static{this.\u0275inj=n.G2t({imports:[l.MD,u.YN,a.bv,p.iI.forChild(b)]})}}return e})()}}]);